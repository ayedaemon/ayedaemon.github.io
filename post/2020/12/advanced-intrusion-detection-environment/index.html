<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Advanced Intrusion Detection Environment | Connected</title>
<meta name="keywords" content="IDS, Security, Linux">
<meta name="description" content="
Host-based intrusion detection system (HIDS) for checking the integrity of files.
">
<meta name="author" content="ayedaemon">
<link rel="canonical" href="https://ayedaemon.github.io/post/2020/12/advanced-intrusion-detection-environment/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ayedaemon.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ayedaemon.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ayedaemon.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://ayedaemon.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://ayedaemon.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Advanced Intrusion Detection Environment" />
<meta property="og:description" content="
Host-based intrusion detection system (HIDS) for checking the integrity of files.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ayedaemon.github.io/post/2020/12/advanced-intrusion-detection-environment/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-12-19T14:25:28+05:30" />
<meta property="article:modified_time" content="2020-12-19T14:25:28+05:30" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Advanced Intrusion Detection Environment"/>
<meta name="twitter:description" content="
Host-based intrusion detection system (HIDS) for checking the integrity of files.
"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ayedaemon.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Advanced Intrusion Detection Environment",
      "item": "https://ayedaemon.github.io/post/2020/12/advanced-intrusion-detection-environment/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Advanced Intrusion Detection Environment",
  "name": "Advanced Intrusion Detection Environment",
  "description": " Host-based intrusion detection system (HIDS) for checking the integrity of files.\n",
  "keywords": [
    "IDS", "Security", "Linux"
  ],
  "articleBody": " Host-based intrusion detection system (HIDS) for checking the integrity of files.\nAdvanced Intrusion Detection Environment (AIDE) is a host-based intrusion detection system (HIDS) for checking the integrity of files. It does this by creating a baseline database of files on an initial run, and then checks this database against the system on subsequent runs. File properties that can be checked against include inode, permissions, modification time, file contents, etc‚Ä¶‚Ä¶‚Ä¶.. more at archwikiüìö\nAccording to the definition, AIDE only checks for the integrity of file but not for rootkits and logs for other suspicious activities.\nBut there are other HIDS tools that can do this for you. Like, Splunk and OSSEC.\nAIDE have provided a pretty simple documentation to undertand and get familiar with it.\nHow to install it? # Check what repo will provide you aide tool. yum whatprovides aide # And then install it, if available. yum install aide -y Next step ..?? Let‚Äôs check the files unpacked from the aide package we just installed.\nWe found a configuration file ‚Äî /etc/aide.conf.\n# open the file with vim or your favourite text editor vim /etc/aide.conf # The file looked very huge so I checked its length. wc /etc/aide.conf # OUTPUT: # 312 765 7333 /etc/aide.conf Fortunately they have given a man page for the configurations settings.\nman 5 aide.conf This gives me a good news. There are only 3 types of line in the configuration file.\nThere are the 1Ô∏è‚É£configuration lines which are used to set configuration parameters and define/undefine variables. There are 2Ô∏è‚É£selection lines that are used to indicate which files are added to the database. 3Ô∏è‚É£ macro lines define or undefine variables within the config file. Lines beginning with # are ignored as comments.#Ô∏è‚É£ You can now check the config file and things will make more sense to you. Also you can check the key-value pairs from man page.\nEnough for configuration‚Ä¶ How to use it? Go to the man page of aide.\n# from terminal man aide Again a reminder, and I quote.\nAIDE is an intrusion detection system for checking the integrity of files.\nOne thing to notice here is DIAGNOSTICS (Scroll down to bottom on the man page).\nAnother is, that AIDE can be controlled using few basic commands.\nTime for some fun now!! Game-play\nCreate a folder and some files in it. Configure AIDE to add that folder in database. Have fun with the folder and files and check the AIDE logs for reports. Adding my new folder and files to aide.conf\n#-------------- My-Settings --------------- myfilter = sha256 /fun-with-aide myfilter This rule is a regular expression rule and will match the complete path of any file starting from /fun-with-aide, so this will include the files inside this folder.\nNow some simple steps to follow:\n* aide --init * cp /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz * aide --check What if we tinker with the file /fun-with-aide/file1?\nI have changed the content of the file1, due to which the sha256sum has also changed. This should be reported by aide in reports.\nThis generates a report that tells about the changes. I‚Äôll get a count of added files, removed files and changed files, along with the name of those files and some detailed information.\nAIDE can be run manually if desired, but automation is the way nowadays.\nCheck the below provided simple cron job script to automatically check for the changes. For more complex examples check this and this.\n# SOURCE: https://wiki.archlinux.org/index.php/AIDE #!/bin/bash -e # these should be the same as what's defined in /etc/aide.conf database=/var/lib/aide/aide.db.gz database\\_out=/var/lib/aide/aide.db.new.gz if [ ! -f \"$database\" ]; then echo \"$database not found\" \u003e\u00262 exit 1 fi aide -u || true mv $database $database.back mv $database\\_out $database What about if attacker changed the database??\nWhen I checked the file type of the aide.db.gz‚Ä¶ It came out to be a gzip compressed data, from Unix, max compression file.\nThis makes it very obvious to unzip this compressed file. I prefer using gunzip tool.\nSpecification of the db is also mentioned in the file.\nVisualizing the above in a tabular manner.\nYou can add more filters and integrity checks to test other things as well.\nThis whole db thing gives rise to a question. What if the attacker modifies the db??\nHmmm.. then he winsü§∑‚Äç‚ôÇÔ∏è. You have to keep your db secure from attackers. For this, you should keep your database in read-only mode. So that it can be only read and no modifications can be done to this. Also you can keep the DB in a different location like in a centralized server or in a removable media like pendrive. Or you can have it your way.\nYou can read more about Integrity Concepts here for better security guidelines.\nConclusion In the end, let‚Äôs understand how AIDE does what it does.\nAIDE takes a ‚Äúsnapshot‚Äù of the state of the system, register hashes, modification times, and other data regarding the files defined by the administrator. This ‚Äúsnapshot‚Äù is used to build a database that is saved and may be stored on an external device for safekeeping.\nWhen the administrator wants to run an integrity test, the administrator places the previously built database in an accessible place and commands AIDE to compare the database against the real status of the system. Should a change have happened to the computer between the snapshot creation and the test, AIDE will detect it and report it to the administrator. Alternatively, AIDE can be configured to run on a schedule and report changes daily using scheduling technologies such as cron.üîö\n",
  "wordCount" : "920",
  "inLanguage": "en",
  "datePublished": "2020-12-19T14:25:28+05:30",
  "dateModified": "2020-12-19T14:25:28+05:30",
  "author":[{
    "@type": "Person",
    "name": "ayedaemon"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ayedaemon.github.io/post/2020/12/advanced-intrusion-detection-environment/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Connected",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ayedaemon.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ayedaemon.github.io/" accesskey="h" title="Connected (Alt + H)">Connected</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ayedaemon.github.io/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://ayedaemon.github.io/series/" title="Series">
                    <span>Series</span>
                </a>
            </li>
            <li>
                <a href="https://ayedaemon.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://ayedaemon.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Advanced Intrusion Detection Environment
    </h1>
    <div class="post-meta"><span title='2020-12-19 14:25:28 +0530 +0530'>December 19, 2020</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;920 words&nbsp;¬∑&nbsp;ayedaemon&nbsp;|&nbsp;<a href="https://github.com/ayedaemon/ayedaemon.github.io/content/post/2020/12/Advanced-Intrusion-Detection-Environment.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#how-to-install-it" aria-label="How to install it?">How to install it?</a></li>
                <li>
                    <a href="#next-step-" aria-label="Next step ..??">Next step ..??</a></li>
                <li>
                    <a href="#enough-for-configuration-how-to-use-it" aria-label="Enough for configuration‚Ä¶ How to use it?">Enough for configuration‚Ä¶ How to use it?</a></li>
                <li>
                    <a href="#time-for-some-fun-now" aria-label="Time for some fun now!!">Time for some fun now!!</a></li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>Host-based intrusion detection system (HIDS) for checking the integrity of files.</p>
</blockquote>
<p>Advanced Intrusion Detection Environment (AIDE) is a <strong>host-based intrusion detection system (HIDS)</strong> for checking the integrity of files. It does this by creating a <strong>baseline database</strong> of files on an initial run, and then checks this database against the system on subsequent runs. File properties that can be checked against include inode, permissions, modification time, file contents, etc‚Ä¶‚Ä¶‚Ä¶.. <a href="https://wiki.archlinux.org/index.php/AIDE"><em>more at archwiki</em>üìö</a></p>
<p>According to the definition, AIDE only checks for the <strong>integrity of file</strong> but <strong>not for rootkits</strong> and logs for other suspicious activities.</p>
<p><em>But there are other HIDS tools that can do this for you. Like,</em> <a href="https://www.splunk.com/"><em>Splunk</em></a> <em>and</em> <a href="https://www.ossec.net/"><em>OSSEC</em></a><em>.</em></p>
<p>AIDE have provided a <a href="https://aide.github.io/doc/">pretty simple documentation</a> to undertand and get familiar with it.</p>
<h3 id="how-to-install-it">How to install it?<a hidden class="anchor" aria-hidden="true" href="#how-to-install-it">#</a></h3>
<pre tabindex="0"><code># Check what repo will provide you aide tool.  

yum whatprovides aide  

# And then install it, if available.  

yum install aide -y
</code></pre><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*GH5ZoirRAKBXJOdkSk4K2A.png" alt="aide-whatprovides-install"  />
</p>
<h3 id="next-step-">Next step ..??<a hidden class="anchor" aria-hidden="true" href="#next-step-">#</a></h3>
<p>Let‚Äôs check the files unpacked from the <strong>aide package</strong> we just installed.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*WBBWo0dITSPIgjfNqPTrZA.png" alt="aide-rpm-ql"  />
</p>
<p>We found a configuration file ‚Äî <code>/etc/aide.conf</code>.</p>
<pre tabindex="0"><code># open the file with vim or your favourite text editor  

vim /etc/aide.conf  

# The file looked very huge so I checked its length.  

wc /etc/aide.conf  

# OUTPUT:  
# 312 765 7333 /etc/aide.conf
</code></pre><p>Fortunately they have given a man page for the configurations settings.</p>
<pre tabindex="0"><code>man 5 aide.conf
</code></pre><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*0HZv3rMcdAFMTbYiyPn_Xw.png" alt="aide.conf"  />
</p>
<p>This gives me a good news. There are only 3 types of line in the configuration file.</p>
<ul>
<li>There are the 1Ô∏è‚É£<em>configuration lines</em> which are used to <strong>set configuration parameters</strong> and <strong>define/undefine variables</strong>.</li>
<li>There are 2Ô∏è‚É£<em>selection lines</em> that are used to indicate <strong>which files are added</strong> to the database.</li>
<li>3Ô∏è‚É£ <em>macro lines</em> <strong>define or undefine variables</strong> within the config file.</li>
<li>Lines beginning with # are ignored as <strong>comments</strong>.#Ô∏è‚É£</li>
</ul>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*LRp9V0giXu-oxaae.gif" alt="Really"  />
</p>
<p>You can now check the config file and things will make more sense to you. Also you can check the key-value pairs from <a href="https://linux.die.net/man/5/aide.conf">man page</a>.</p>
<h3 id="enough-for-configuration-how-to-use-it">Enough for configuration‚Ä¶ How to use it?<a hidden class="anchor" aria-hidden="true" href="#enough-for-configuration-how-to-use-it">#</a></h3>
<p>Go to the <a href="https://linux.die.net/man/1/aide">man page</a> of aide.</p>
<pre tabindex="0"><code># from terminal  

man aide
</code></pre><p>Again a reminder, and I quote.</p>
<blockquote>
<p>AIDE is an <strong>intrusion detection system</strong> for checking the <strong>integrity of files</strong>.</p>
</blockquote>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*gNw75QXgQiRPoxgopKvZSQ.png" alt="man-aide"  />
</p>
<p>One thing to notice here is <em><strong>DIAGNOSTICS</strong></em> (<em>Scroll down to bottom on the man page</em>).</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*m3ygM3U9O_-eooMR-3NJcA.png" alt="diagnostics"  />
</p>
<p>Another is, that AIDE can be controlled using few basic commands.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*nYCpUl-Pv4oHGnjbTsYXew.png" alt="commands"  />
</p>
<h3 id="time-for-some-fun-now">Time for some fun now!!<a hidden class="anchor" aria-hidden="true" href="#time-for-some-fun-now">#</a></h3>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*eV9LiAtIIoAbbflD.gif" alt="lets-play"  />
</p>
<p><strong>Game-play</strong></p>
<ul>
<li>Create a folder and some files in it.</li>
<li>Configure AIDE to add that folder in database.</li>
<li>Have fun with the folder and files and check the AIDE logs for reports.</li>
</ul>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*4RBSuCrL2W9C1Y9MspWl2w.png" alt="create-folder"  />
</p>
<p>Adding my new folder and files to aide.conf</p>
<pre tabindex="0"><code>#-------------- My-Settings ---------------  

myfilter = sha256  

/fun-with-aide myfilter
</code></pre><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*aC940c2LfvDHrQu_D4nKoA.png" alt="add-to-conf"  />
</p>
<p>This rule is a regular expression rule and will match the complete path of any file starting from /fun-with-aide, so this will include the files inside this folder.</p>
<p>Now some simple steps to follow:</p>
<pre tabindex="0"><code>* aide --init
* cp /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz
* aide --check
</code></pre><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*G7iCTRi0C6ttmWQe3-oxyA.png" alt="aide-check"  />
</p>
<p>What if we tinker with the file /fun-with-aide/file1?</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*wDbGmR7vps5vsqs3i8_Icg.png" alt="tinker-file1"  />
</p>
<p>I have changed the content of the file1, due to which the sha256sum has also changed. This should be reported by <strong>aide</strong> in reports.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*z0Zq2wGpayGYo079V8bgUw.png" alt="aide-check"  />
</p>
<p>This generates a report that tells about the changes. I‚Äôll get a count of <em>added files</em>, <em>removed files</em> and <em>changed files</em>, along with the name of those files and some detailed information.</p>
<hr>
<p>AIDE can be run manually if desired, but automation is the way nowadays.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*ip12LNV58018AQ8G.gif" alt="yeah-automation"  />
</p>
<p>Check the below provided simple cron job script to automatically check for the changes. For more complex examples check <a href="https://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/app-forensics/aide/files/aide.cron">this</a> and <a href="https://rfxn.com/downloads/cron.aide">this</a>.</p>
<pre tabindex="0"><code># SOURCE: https://wiki.archlinux.org/index.php/AIDE  

#!/bin/bash -e  

# these should be the same as what&#39;s defined in /etc/aide.conf  
database=/var/lib/aide/aide.db.gz  
database\_out=/var/lib/aide/aide.db.new.gz  

if [ ! -f &#34;$database&#34; ]; then  
 echo &#34;$database not found&#34; &gt;&amp;2  
 exit 1  
fi  

aide -u || true  

mv $database $database.back  
mv $database\_out $database
</code></pre><hr>
<p><strong>What about if attacker changed the database??</strong></p>
<p>When I checked the file type of the <em>aide.db.gz</em>&hellip; It came out to be a gzip compressed data, from Unix, max compression file.</p>
<p>This makes it very obvious to unzip this compressed file. I prefer using gunzip tool.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*rP1BY4TIP5OLCxQj4_GrGw.png" alt="operation-theatre"  />
</p>
<p>Specification of the db is also mentioned in the file.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*FB264rJGlMj1Tr-4tPSWHg.png" alt="db_spec"  />
</p>
<p>Visualizing the above in a tabular manner.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*3MXSU4ub4fgXolHfPB34Qw.png" alt=""  />
</p>
<p><strong>You can add more filters and integrity checks to test other things as well.</strong></p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*v87DoqZLe0Cq2K-f.gif" alt="being-tonystark"  />
</p>
<p>This whole db thing gives rise to a question. <strong>What if the attacker modifies the db??</strong></p>
<p>Hmmm.. then he winsü§∑‚Äç‚ôÇÔ∏è. You have to keep your db secure from attackers. For this, you should keep your database in <strong>read-only mode</strong>. So that it can be only read and no modifications can be done to this. Also you can keep the DB in a different location like in a <strong>centralized server</strong> or in a <strong>removable media like pendrive</strong>. Or you can have it your way.</p>
<p>You can read more about <a href="https://wiki.gentoo.org/wiki/Integrity/Concepts">Integrity Concepts</a> here for better security guidelines.</p>
<h3 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h3>
<p>In the end, let‚Äôs understand how AIDE does what it does.</p>
<p>AIDE takes a ‚Äúsnapshot‚Äù of the state of the system, register hashes, modification times, and other data regarding the files defined by the administrator. This ‚Äúsnapshot‚Äù is used to build a database that is saved and may be stored on an external device for safekeeping.</p>
<p>When the administrator wants to run an integrity test, the administrator places the previously built database in an accessible place and commands AIDE to compare the database against the real status of the system. Should a change have happened to the computer between the snapshot creation and the test, AIDE will detect it and report it to the administrator. Alternatively, AIDE can be configured to run on a schedule and report changes daily using scheduling technologies such as cron.üîö</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*S_aFpI3KDiWfts2v.gif" alt="end"  />
</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ayedaemon.github.io/tags/ids/">IDS</a></li>
      <li><a href="https://ayedaemon.github.io/tags/security/">Security</a></li>
      <li><a href="https://ayedaemon.github.io/tags/linux/">Linux</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://ayedaemon.github.io/">Connected</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
