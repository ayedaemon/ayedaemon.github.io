<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Intro to Re: C : A Simple Calculator | Connected</title>
<meta name=keywords content="RE,linux,C programming"><meta name=description content="How to reverse engineer a simple calculator program from scratch"><meta name=author content="ayedaemon"><link rel=canonical href=https://ayedaemon.github.io/post/2023/04/intro-to-re-simple-calculator/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://ayedaemon.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ayedaemon.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ayedaemon.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ayedaemon.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ayedaemon.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Intro to Re: C : A Simple Calculator"><meta property="og:description" content="How to reverse engineer a simple calculator program from scratch"><meta property="og:type" content="article"><meta property="og:url" content="https://ayedaemon.github.io/post/2023/04/intro-to-re-simple-calculator/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-04-03T21:59:48+05:30"><meta property="article:modified_time" content="2023-11-26T23:45:19+05:30"><meta property="og:site_name" content="Connected"><meta property="og:see_also" content="https://ayedaemon.github.io/post/2023/05/intro-to-re-part-4/"><meta property="og:see_also" content="https://ayedaemon.github.io/post/2023/04/intro-to-re-part-3/"><meta property="og:see_also" content="https://ayedaemon.github.io/post/2023/03/intro-to-re-part-2/"><meta property="og:see_also" content="https://ayedaemon.github.io/post/2022/09/intro-to-re/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Intro to Re: C : A Simple Calculator"><meta name=twitter:description content="How to reverse engineer a simple calculator program from scratch"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ayedaemon.github.io/post/"},{"@type":"ListItem","position":2,"name":"Intro to Re: C : A Simple Calculator","item":"https://ayedaemon.github.io/post/2023/04/intro-to-re-simple-calculator/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Intro to Re: C : A Simple Calculator","name":"Intro to Re: C : A Simple Calculator","description":"How to reverse engineer a simple calculator program from scratch","keywords":["RE","linux","C programming"],"articleBody":"We covered a wide range of topics in earlier articles that were helpful in comprehending how many lower-level processes operate. This blog will concentrate on applying those ideas to recreate C program after reverse engineering a simple calculator binary.\nIt is always a good idea to observe how the target software responds to various inputs. This gives you a sense of the internal logic that might be operating.\nIf we run this program without any arguments, we will get an error message stating that we need to pass more arguments as well as the usage guide is printed.\n❯ ./calc Not enough arguments passed Usage: ./calc So I can assume that there are checks in place which will see if we’ve passed enough arguments. If not, it’ll exit with the above message.\nSo its obvious for anybody now to try it with the arguments this time.\n❯ ./calc 5 + 3 5 + 3 = 8 ❯ ./calc 100 / 5 100 / 5 = 20 This works now and gives us the required output in a good looking way. That should do it for now.\nIt’s time to open up our hacker tools and disassemble the binary.\nDisassembly:-\naddFunc: push rbp mov rbp, rsp mov DWORD PTR [rbp-4], edi mov DWORD PTR [rbp-8], esi mov edx, DWORD PTR [rbp-4] mov eax, DWORD PTR [rbp-8] add eax, edx pop rbp ret subFunc: push rbp mov rbp, rsp mov DWORD PTR [rbp-4], edi mov DWORD PTR [rbp-8], esi mov eax, DWORD PTR [rbp-4] sub eax, DWORD PTR [rbp-8] pop rbp ret mulFunc: push rbp mov rbp, rsp mov DWORD PTR [rbp-4], edi mov DWORD PTR [rbp-8], esi mov eax, DWORD PTR [rbp-4] imul eax, DWORD PTR [rbp-8] pop rbp ret divFunc: push rbp mov rbp, rsp mov DWORD PTR [rbp-4], edi mov DWORD PTR [rbp-8], esi mov eax, DWORD PTR [rbp-4] cdq idiv DWORD PTR [rbp-8] pop rbp ret .LC0: .string \"Not enough arguments passed\" .LC1: .string \"Usage: ./calc \" die: push rbp mov rbp, rsp mov edi, OFFSET FLAT:.LC0 call puts mov edi, OFFSET FLAT:.LC1 call puts mov edi, 1 call exit .LC2: .string \"%d %c %d = %d\\n\" main: push rbp mov rbp, rsp sub rsp, 48 mov DWORD PTR [rbp-36], edi mov QWORD PTR [rbp-48], rsi cmp DWORD PTR [rbp-36], 3 jg .L11 mov eax, 0 call die .L11: mov rax, QWORD PTR [rbp-48] add rax, 8 mov rax, QWORD PTR [rax] mov rdi, rax call atoi mov DWORD PTR [rbp-12], eax mov rax, QWORD PTR [rbp-48] add rax, 24 mov rax, QWORD PTR [rax] mov rdi, rax call atoi mov DWORD PTR [rbp-16], eax mov rax, QWORD PTR [rbp-48] add rax, 16 mov rax, QWORD PTR [rax] movzx eax, BYTE PTR [rax] mov BYTE PTR [rbp-17], al movsx eax, BYTE PTR [rbp-17] cmp eax, 47 je .L12 cmp eax, 47 jg .L13 cmp eax, 45 je .L14 cmp eax, 45 jg .L13 cmp eax, 42 je .L15 cmp eax, 43 jne .L13 mov QWORD PTR [rbp-8], OFFSET FLAT:addFunc jmp .L13 .L14: mov QWORD PTR [rbp-8], OFFSET FLAT:subFunc jmp .L13 .L15: mov QWORD PTR [rbp-8], OFFSET FLAT:mulFunc jmp .L13 .L12: mov QWORD PTR [rbp-8], OFFSET FLAT:divFunc nop .L13: mov edx, DWORD PTR [rbp-16] mov eax, DWORD PTR [rbp-12] mov rcx, QWORD PTR [rbp-8] mov esi, edx mov edi, eax call rcx mov esi, eax movsx edx, BYTE PTR [rbp-17] mov ecx, DWORD PTR [rbp-16] mov eax, DWORD PTR [rbp-12] mov r8d, esi mov esi, eax mov edi, OFFSET FLAT:.LC2 mov eax, 0 call printf nop leave ret This is far too large to handle at once. So I’ll start with smaller functions and see what they do before moving on to the main function.\n(In my opinion, there is no specific reverse engineering flow. You could start from anywhere that suits your needs and the project at hand.)\nNow the first function I’ll start with is going to be the addFunc.\naddFunc: push rbp mov rbp, rsp mov DWORD PTR [rbp-4], edi mov DWORD PTR [rbp-8], esi mov edx, DWORD PTR [rbp-4] mov eax, DWORD PTR [rbp-8] add eax, edx pop rbp ret The first three lines are simply the function’s label and prologue.\nThen there are two mov statements (lines 4 and 5) that involve edi (first argument) and esi (second argument) (second argument). They are the function arguments passed from the calling function to this function. These values are then saved in the [rbp-4] and [rbp-8] local variables.\nGiven the variable size requirements (4 bytes each), it is safe to assume that the passed variables are of the int type. That is, we are passing this function two int values.\nThen, at lines 6, 7, and 8, we simply load the values from the variables into some registers and then add them up. In this case, the result of the add instruction will be stored in the eax register. Remember, this is also the register where the return value of a function is stored. So when we return back from this function, we have our addition result in the eax register.\nFinally, at line 9 \u0026 10, we make a graceful return from the function.\nSimilar behaviour is followed by next 3 functions - subFunc, mulFunc and divFunc.\nsubFunc: ; Prologue push rbp mov rbp, rsp ; Function arguments mov DWORD PTR [rbp-4], edi mov DWORD PTR [rbp-8], esi ; Load values and perform subtraction mov eax, DWORD PTR [rbp-4] sub eax, DWORD PTR [rbp-8] ; Return value is already in EAX, just return pop rbp ret mulFunc: ; Prologue push rbp mov rbp, rsp ; Function arguments mov DWORD PTR [rbp-4], edi mov DWORD PTR [rbp-8], esi ; Load values and perform multiplication mov eax, DWORD PTR [rbp-4] imul eax, DWORD PTR [rbp-8] ; Return value is already in EAX, just return pop rbp ret divFunc: ; Prologue push rbp mov rbp, rsp ; Function arguments mov DWORD PTR [rbp-4], edi mov DWORD PTR [rbp-8], esi ; Load values and perform division mov eax, DWORD PTR [rbp-4] cdq idiv DWORD PTR [rbp-8] ; Return value is already in EAX, just return pop rbp ret Now we are done with all the functions that perform the computations, next comes the function which prints the help message and then exits.\n.LC0: .string \"Not enough arguments passed\" .LC1: .string \"Usage: ./calc \" die: push rbp mov rbp, rsp mov edi, OFFSET FLAT:.LC0 call puts mov edi, OFFSET FLAT:.LC1 call puts mov edi, 1 call exit The name implies that the purpose of this function is to terminate the execution of the calc program. Lines 8-9 show that this function is printing something using the puts function. The function’s argument is a string starting at offset .LC0 - \"Insufficient arguments passed\". Lines 9-10 contain another call for puts with an argument from offset .LC1 - \"Usage: ./calc \".\nThese both puts statements combined give the error message we got when we tried to execute the program without any arguments.\nFinally, it terminates with an exit function call (no return), and the function’s argument was the integer value 1. Typically, the return value for successful execution is zero, and all non-zero values denote some type of execution error. So exiting with 1 indicates an error.\nNow we know what each function do at atomic level. Let’s load our big guns and take a shot at main() function.\n.LC2: .string \"%d %c %d = %d\\n\" main: push rbp mov rbp, rsp sub rsp, 48 mov DWORD PTR [rbp-36], edi mov QWORD PTR [rbp-48], rsi cmp DWORD PTR [rbp-36], 3 jg .L11 mov eax, 0 call die .L11: mov rax, QWORD PTR [rbp-48] add rax, 8 mov rax, QWORD PTR [rax] mov rdi, rax call atoi mov DWORD PTR [rbp-12], eax mov rax, QWORD PTR [rbp-48] add rax, 24 mov rax, QWORD PTR [rax] mov rdi, rax call atoi mov DWORD PTR [rbp-16], eax mov rax, QWORD PTR [rbp-48] add rax, 16 mov rax, QWORD PTR [rax] movzx eax, BYTE PTR [rax] mov BYTE PTR [rbp-17], al movsx eax, BYTE PTR [rbp-17] cmp eax, 47 je .L12 cmp eax, 47 jg .L13 cmp eax, 45 je .L14 cmp eax, 45 jg .L13 cmp eax, 42 je .L15 cmp eax, 43 jne .L13 mov QWORD PTR [rbp-8], OFFSET FLAT:addFunc jmp .L13 .L14: mov QWORD PTR [rbp-8], OFFSET FLAT:subFunc jmp .L13 .L15: mov QWORD PTR [rbp-8], OFFSET FLAT:mulFunc jmp .L13 .L12: mov QWORD PTR [rbp-8], OFFSET FLAT:divFunc nop .L13: mov edx, DWORD PTR [rbp-16] mov eax, DWORD PTR [rbp-12] mov rcx, QWORD PTR [rbp-8] mov esi, edx mov edi, eax call rcx mov esi, eax movsx edx, BYTE PTR [rbp-17] mov ecx, DWORD PTR [rbp-16] mov eax, DWORD PTR [rbp-12] mov r8d, esi mov esi, eax mov edi, OFFSET FLAT:.LC2 mov eax, 0 call printf nop leave ret The main function still appears to be too large to handle all at once, so I’ll cut it into smaller chunks to bite off and digest properly.\nThe prologue comes first… setting up the function frame; nothing new here.\nmain: push rbp mov rbp, rsp Then we make some space in the frame to store the local variables.\nsub rsp, 48 And then storing edi and rsi values in there. If you remember these two registers indicate the first two arguments passed to a function. In this case, the arguments to main function will be the argc and argv.\nargc –\u003e Count of the cli arguments passed to it. argv –\u003e Pointer to the list of arguments passed. Next up is the comparision…which will check the count of args. This decides the branch the program execution takes - die or live.\ncmp DWORD PTR [rbp-36], 3 jg .L11 mov eax, 0 call die This compares [rbp-36] (argc) with hardcoded value of 3. If the value from argc is greater than 3 then it’ll make a jump to .L11, otherwise it’ll call die function… which will print some messages and then exit with status 1. We already looked at that.\nSo if we write a C program for what we know about main till now, we’ll get something like:\nvoid main(int argc, char* argv[]) { if (argc \u003c 3) { die(); } else { /* Keep on going to know more */ } } Next statements are something new, so you’ll have to believe me when I say that this is equivalent to argv[1].\n.L11: mov rax, QWORD PTR [rbp-48] add rax, 8 mov rax, QWORD PTR [rax] Before I start explaining, take a look at this diagram.\nr a x ┌ │ └ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┌ │ │ │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐ │ ┘ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ► r b p - 4 8 ┌ │ ├ │ ├ │ ├ │ ├ │ ├ │ │ │ │ │ ├ │ ├ │ ├ │ ├ │ ├ │ │ │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ s ─ ─ ─ ─ p ─ ─ ─ ─ ─ ─ ─ o ─ ─ ─ ─ t ─ p ─ p ─ p ─ ─ ─ ─ m ─ ─ ─ ─ r ─ t ─ t ─ t ─ ─ ─ ─ e ─ ─ ─ ─ _ ─ r ─ r ─ r ─ ─ ─ ─ _ ─ ─ ─ ─ t ─ _ ─ _ ─ _ ─ ─ ─ ─ p ─ ─ ─ ─ o ─ t ─ t ─ t ─ ─ ─ ─ o ─ ─ ─ ─ _ ─ o ─ o ─ o ─ ─ ─ ─ i ─ ─ ─ ─ p ─ _ ─ _ ─ + ─ ─ ─ ─ n ─ ─ ─ ─ r ─ a ─ a ─ a ─ ─ ─ ─ t ─ ─ ─ ─ o ─ r ─ r ─ r ─ ─ ─ ─ e ─ ─ ─ ─ g ─ g ─ g ─ g ─ ─ ─ ─ r ─ ─ ─ ─ _ ─ 1 ─ 2 ─ 3 ─ ─ ─ ─ _ ─ ─ ─ ─ n ─ ─ ─ ─ ─ ─ ─ v ─ ─ ─ ─ a ─ ─ ─ ─ ─ ─ ─ a ─ ─ ─ ─ m ─ ─ ─ ─ ─ ─ ─ l ─ ─ ─ ─ e ─ ─ ─ ─ ─ ─ ─ u ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ e ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐ │ ┤ │ ┤ │ ┤ │ ┤ │ ┤ │ │ │ │ │ ┤ │ ┤ │ ┤ │ ┤ │ ┤ │ │ │ ─ s s s s ─ o o o o ─ m m m m ─ e e e e ─ _ _ _ _ ─ p p p p ─ o o o o ─ i i i i ─ n n n n ┐ │ │ │ │ │ │ │ │ │ ▼ t t t t e e e e r r r r _ _ _ _ v v v v a a a a l l l l u u u u e e e e + + + 8 1 2 6 4 Now with this in your mind, we can start to understand the above 3 instructions.\nmov rax, QWORD PTR [rbp-48] This instruction loads the some_pointer_value into rax register.\nadd rax, 8 This adds up 8 to rax value. That means now the resultant value is some_pointer_value + 8. If you don’t know it already, 8 is the size of a pointer on most x86_64 machines. So if we want to add for 2 pointers, we’ll need something like some_pointer_value + 16.\nmov rax, QWORD PTR [rax] Now we load the value from that location. In C language, this would be equivalent to *(argv + 1) or argv[1] or if you are feeling funny 1[argv]. HOW?? 1\nNow, next instruction calls atoi function with the argv[1] as it’s first argument.\nmov rdi, rax call atoi atoi function changes character value to respective integer value. As an example, '1' (in char) will be converted to 1 (in int).\nmov DWORD PTR [rbp-12], eax And then whatever is returned by that function will be stored in a local variable pointed by rbp-12. Remember, eax register is used to store the return values from called functions (atio) to caller function (main).\nNext set of instructions is quite similar to what we just saw.\nmov rax, QWORD PTR [rbp-48] add rax, 24 mov rax, QWORD PTR [rax] mov rdi, rax call atoi mov DWORD PTR [rbp-16], eax If you notice, here we are adding 24(8 * 3 = 24) so that means arg3 is being used - argv[3]. Till this point we have successfully converted argv[1] and argv[3] to integers. These are the number1 and number2 values for our litte calculator.\nNow argv[2]… our operator character… 1 byte value.\nmov rax, QWORD PTR [rbp-48] add rax, 16 mov rax, QWORD PTR [rax] movzx eax, BYTE PTR [rax] mov BYTE PTR [rbp-17], al This adds 16 - means argv[2]. So we load the value and then just pick up the lowest 1 byte value al from the whole thing and store it in [rbp-17] location.\nLet’s update our C program with the new findings.\nvoid main(int argc, char* argv[]) { if (argc \u003c 3) { die(); } else { int num1 = atoi(argv[1]); int num2 = atoi(argv[3]); char op = argv[2]; /* Keep on going to know more */ } } Next few lines of disassembly code looks like a conditional branch…. So many “compare and jump” instructions.\nmovsx eax, BYTE PTR [rbp-17] cmp eax, 47 je .L12 cmp eax, 47 jg .L13 cmp eax, 45 je .L14 cmp eax, 45 jg .L13 cmp eax, 42 je .L15 cmp eax, 43 jne .L13 mov QWORD PTR [rbp-8], OFFSET FLAT:addFunc jmp .L13 .L14: mov QWORD PTR [rbp-8], OFFSET FLAT:subFunc jmp .L13 .L15: mov QWORD PTR [rbp-8], OFFSET FLAT:mulFunc jmp .L13 .L12: mov QWORD PTR [rbp-8], OFFSET FLAT:divFunc nop The value being compared is stored in [rbp-17] in this case. This contains the operator character from argv[2]. If you convert the values this is compared to to char equivalents, you’ll get the following:\n47 is /, 45 is -, 42 is *, and 43 is +. With some calculations, you can conclude where the control will jump. To sum up,\nif the operator is 47 (/), then it’ll jump to .L12. Which will move the offset location for divFunc function to a local variable.\nif the operator is 45 (-), then it’ll move offset location for subFunc function to that local variable.\nif the operator is 42 (*), then it’ll move offset location for mulFunc function to that local variable.\nif the operator is 42 (+), then it’ll move offset location for addFunc function to that local variable.\nIn any other given input, it’ll simply move forward to .L13.\n.L13: mov edx, DWORD PTR [rbp-16] mov eax, DWORD PTR [rbp-12] mov rcx, QWORD PTR [rbp-8] mov esi, edx mov edi, eax call rcx mov esi, eax movsx edx, BYTE PTR [rbp-17] mov ecx, DWORD PTR [rbp-16] mov eax, DWORD PTR [rbp-12] mov r8d, esi mov esi, eax mov edi, OFFSET FLAT:.LC2 mov eax, 0 call printf nop leave ret Before reaching .L13, we have 4 variables in our program:-\nnumber1 - stored at [rbp-12] number2 - stored at [rbp-16] operator - stored at [rbp-17] pointer to the function which is selected on the basis of operator. This is stored at [rbp-8]. Now that we’re in .L13,\nWe assign the number1, number2, and the function pointer to eax, edx, and rcx, respectively. The function is then called with the arguments number1 and number2. Finally, the outcome is saved.\nThe remainder of the .L13 consists entirely of calling a printf function with a format string and other local variables. The final result will look like this: = . I’ll leave it to you to dissect and solve the final puzzle piece. After printing, the function then exits gracefully.\nNow we can put everything together, and the complete code should look something like this.\n#include #include // Function to perform addition int addFunc(int a, int b) { return a + b; } // Function to perform subtraction int subFunc(int a, int b) { return a - b; } // Function to perform multiplication int mulFunc(int a, int b) { return a * b; } // Function to perform division int divFunc(int a, int b) { return a / b; } // Function to print usage message and exit void die() { printf(\"Not enough arguments passed\\n\"); printf(\"Usage: ./calc \\n\"); exit(1); } // main function void main(int argc, char *argv[]) { if(argc \u003c 4) die(); int x = atoi(argv[1]); int y = atoi(argv[3]); char option = *argv[2]; int (*fp) (int, int); switch(option) { case '+': { fp = addFunc; break; } case '-': { fp = subFunc; break; } case '*': { fp = mulFunc; break; } case '/': { fp = divFunc; break; } } printf(\"%d %c %d = %d\\n\", x, option, y, fp(x,y)); } This may not be what the original developer wrote, but it will certainly behave the same. That is the entire point of reverse engineering. Dissecting something with your tools to understand how it behaves and then creating something that mimics the behavior.\nI’ll encourage you to go and try to reverse engineer some more binaries. You can build your own if you want or just download some from online platforms like crackme.one. Have fun!!\nhttps://stackoverflow.com/questions/381542/with-arrays-why-is-it-the-case-that-a5-5a ↩︎\n","wordCount":"3378","inLanguage":"en","datePublished":"2023-04-03T21:59:48+05:30","dateModified":"2023-11-26T23:45:19+05:30","author":[{"@type":"Person","name":"ayedaemon"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://ayedaemon.github.io/post/2023/04/intro-to-re-simple-calculator/"},"publisher":{"@type":"Organization","name":"Connected","logo":{"@type":"ImageObject","url":"https://ayedaemon.github.io/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://ayedaemon.github.io/ accesskey=h title="Connected (Alt + H)">Connected</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://ayedaemon.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://ayedaemon.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ayedaemon.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ayedaemon.github.io/series/ title=Series><span>Series</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ayedaemon.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ayedaemon.github.io/post/>Posts</a></div><h1 class=post-title>Intro to Re: C : A Simple Calculator</h1><div class=post-description>How to reverse engineer a simple calculator program from scratch</div><div class=post-meta><span title='2023-04-03 21:59:48 +0530 +0530'>April 3, 2023</span>&nbsp;·&nbsp;16 min&nbsp;·&nbsp;3378 words&nbsp;·&nbsp;ayedaemon&nbsp;|&nbsp;<a href=https://github.com/ayedaemon/ayedaemon.github.io/tree/main/content/post/2023/04/intro-to-re-simple-calculator.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>We covered a wide range of topics in earlier articles that were helpful in comprehending how many lower-level processes operate. This blog will concentrate on applying those ideas to recreate C program after reverse engineering a simple calculator binary.</p><p><img loading=lazy src=https://media.giphy.com/media/Pmv6m86yGQCjkLjmqx/giphy.gif#center alt></p><p>It is always a good idea to observe how the target software responds to various inputs. This gives you a sense of the internal logic that might be operating.</p><p>If we run this program without any arguments, we will get an error message stating that we need to pass more arguments as well as the usage guide is printed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>❯ ./calc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Not enough arguments passed
</span></span><span class=line><span class=cl>Usage: ./calc &lt;num1&gt; &lt;operator&gt; &lt;num2&gt;
</span></span></code></pre></div><p>So I can assume that there are checks in place which will see if we&rsquo;ve passed enough arguments. If not, it&rsquo;ll exit with the above message.</p><p>So its obvious for anybody now to try it with the arguments this time.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>❯ ./calc 5 + 3
</span></span><span class=line><span class=cl>5 + 3 = 8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>❯ ./calc 100 / 5
</span></span><span class=line><span class=cl>100 / 5 = 20
</span></span></code></pre></div><p>This works now and gives us the required output in a good looking way. That should do it for now.</p><p>It&rsquo;s time to open up our hacker tools and disassemble the binary.</p><p>Disassembly:-</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>addFunc:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>edx</span>
</span></span><span class=line><span class=cl>        <span class=nf>pop</span>     <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span><span class=line><span class=cl><span class=nl>subFunc:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>pop</span>     <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span><span class=line><span class=cl><span class=nl>mulFunc:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>imul</span>    <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>pop</span>     <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span><span class=line><span class=cl><span class=nl>divFunc:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>cdq</span>
</span></span><span class=line><span class=cl>        <span class=nf>idiv</span>    <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>pop</span>     <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span><span class=line><span class=cl><span class=nl>.LC0:</span>
</span></span><span class=line><span class=cl>        <span class=na>.string</span> <span class=s>&#34;Not enough arguments passed&#34;</span>
</span></span><span class=line><span class=cl><span class=nl>.LC1:</span>
</span></span><span class=line><span class=cl>        <span class=na>.string</span> <span class=s>&#34;Usage: ./calc &lt;num1&gt; &lt;operator&gt; &lt;num2&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nl>die:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:.</span><span class=no>LC0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>puts</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:.</span><span class=no>LC1</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>puts</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>exit</span>
</span></span><span class=line><span class=cl><span class=nl>.LC2:</span>
</span></span><span class=line><span class=cl>        <span class=na>.string</span> <span class=s>&#34;%d %c %d = %d\n&#34;</span>
</span></span><span class=line><span class=cl><span class=nl>main:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub</span>     <span class=no>rsp</span><span class=p>,</span> <span class=mi>48</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-36</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>],</span> <span class=no>rsi</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-36</span><span class=p>],</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L11</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>die</span>
</span></span><span class=line><span class=cl><span class=nl>.L11:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rdi</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>atoi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>],</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>24</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rdi</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>atoi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>],</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>movzx</span>   <span class=no>eax</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>],</span> <span class=no>al</span>
</span></span><span class=line><span class=cl>        <span class=nf>movsx</span>   <span class=no>eax</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>47</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L12</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>47</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>45</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L14</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>45</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>42</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L15</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>43</span>
</span></span><span class=line><span class=cl>        <span class=nf>jne</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>addFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L14:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>subFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L15:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>mulFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L12:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>divFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>nop</span>
</span></span><span class=line><span class=cl><span class=nl>.L13:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rcx</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>edx</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>rcx</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>movsx</span>   <span class=no>edx</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>ecx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>r8d</span><span class=p>,</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:.</span><span class=no>LC2</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>printf</span>
</span></span><span class=line><span class=cl>        <span class=nf>nop</span>
</span></span><span class=line><span class=cl>        <span class=nf>leave</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span></code></pre></div><p>This is far too large to handle at once. So I&rsquo;ll start with smaller functions and see what they do before moving on to the <code>main</code> function.</p><p><em>(In my opinion, there is no specific reverse engineering flow. You could start from anywhere that suits your needs and the project at hand.)</em></p><p>Now the first function I&rsquo;ll start with is going to be the <code>addFunc</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>addFunc:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>edx</span>
</span></span><span class=line><span class=cl>        <span class=nf>pop</span>     <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span></code></pre></div><p>The first three lines are simply the function&rsquo;s label and prologue.</p><p>Then there are two <code>mov</code> statements (lines 4 and 5) that involve <code>edi</code> (first argument) and <code>esi</code> (second argument) (second argument). They are the function arguments passed from the calling function to this function. These values are then saved in the <code>[rbp-4]</code> and <code>[rbp-8]</code> local variables.</p><p>Given the variable size requirements (4 bytes each), it is safe to assume that the passed variables are of the <code>int</code> type. That is, we are passing this function two <code>int</code> values.</p><p>Then, at lines 6, 7, and 8, we simply load the values from the variables into some registers and then add them up. In this case, the result of the add instruction will be stored in the <code>eax</code> register. Remember, this is also the register where the return value of a function is stored. So when we return back from this function, we have our addition result in the <code>eax</code> register.</p><p>Finally, at line 9 & 10, we make a graceful return from the function.</p><p>Similar behaviour is followed by next 3 functions - <code>subFunc</code>, <code>mulFunc</code> and <code>divFunc</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>subFunc:</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Prologue
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Function arguments
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Load values and perform subtraction
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Return value is already in EAX, just return
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>pop</span>     <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>mulFunc:</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Prologue
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Function arguments
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Load values and perform multiplication
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>imul</span>    <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Return value is already in EAX, just return
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>pop</span>     <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>divFunc:</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Prologue
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Function arguments
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Load values and perform division
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>cdq</span>
</span></span><span class=line><span class=cl>        <span class=nf>idiv</span>    <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=c1>; Return value is already in EAX, just return
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>pop</span>     <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span></code></pre></div><p>Now we are done with all the functions that perform the computations, next comes the function which prints the help message and then exits.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>.LC0:</span>
</span></span><span class=line><span class=cl>        <span class=na>.string</span> <span class=s>&#34;Not enough arguments passed&#34;</span>
</span></span><span class=line><span class=cl><span class=nl>.LC1:</span>
</span></span><span class=line><span class=cl>        <span class=na>.string</span> <span class=s>&#34;Usage: ./calc &lt;num1&gt; &lt;operator&gt; &lt;num2&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nl>die:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:.</span><span class=no>LC0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>puts</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:.</span><span class=no>LC1</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>puts</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>exit</span>
</span></span></code></pre></div><p>The name implies that the purpose of this function is to terminate the execution of the <code>calc</code> program. Lines 8-9 show that this function is printing something using the <code>puts</code> function. The function&rsquo;s argument is a string starting at offset <code>.LC0</code> - <code>"Insufficient arguments passed"</code>. Lines 9-10 contain another call for <code>puts</code> with an argument from offset <code>.LC1</code> - <code>"Usage: ./calc &lt;num1> &lt;operator> &lt;num2>"</code>.</p><p>These both <code>puts</code> statements combined give the error message we got when we tried to execute the program without any arguments.</p><p>Finally, it terminates with an <code>exit</code> function call (no return), and the function&rsquo;s argument was the integer value <code>1</code>. Typically, the return value for successful execution is zero, and all non-zero values denote some type of execution error. <strong>So exiting with 1 indicates an error.</strong></p><p>Now we know what each function do at atomic level. Let&rsquo;s load our big guns and take a shot at <code>main()</code> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>.LC2:</span>
</span></span><span class=line><span class=cl>        <span class=na>.string</span> <span class=s>&#34;%d %c %d = %d\n&#34;</span>
</span></span><span class=line><span class=cl><span class=nl>main:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub</span>     <span class=no>rsp</span><span class=p>,</span> <span class=mi>48</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-36</span><span class=p>],</span> <span class=no>edi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>],</span> <span class=no>rsi</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-36</span><span class=p>],</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L11</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>die</span>
</span></span><span class=line><span class=cl><span class=nl>.L11:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rdi</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>atoi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>],</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>24</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rdi</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>atoi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>],</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>movzx</span>   <span class=no>eax</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>],</span> <span class=no>al</span>
</span></span><span class=line><span class=cl>        <span class=nf>movsx</span>   <span class=no>eax</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>47</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L12</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>47</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>45</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L14</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>45</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>42</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L15</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>43</span>
</span></span><span class=line><span class=cl>        <span class=nf>jne</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>addFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L14:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>subFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L15:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>mulFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L12:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>divFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>nop</span>
</span></span><span class=line><span class=cl><span class=nl>.L13:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rcx</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>edx</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>rcx</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>movsx</span>   <span class=no>edx</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>ecx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>r8d</span><span class=p>,</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:.</span><span class=no>LC2</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>printf</span>
</span></span><span class=line><span class=cl>        <span class=nf>nop</span>
</span></span><span class=line><span class=cl>        <span class=nf>leave</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span></code></pre></div><p>The <code>main</code> function still appears to be too large to handle all at once, so I&rsquo;ll cut it into smaller chunks to bite off and digest properly.</p><p>The prologue comes first&mldr; setting up the function frame; nothing new here.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>main:</span>
</span></span><span class=line><span class=cl>        <span class=nf>push</span>    <span class=no>rbp</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span></code></pre></div><p>Then we make some space in the frame to store the local variables.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>        <span class=nf>sub</span>     <span class=no>rsp</span><span class=p>,</span> <span class=mi>48</span>
</span></span></code></pre></div><p>And then storing <code>edi</code> and <code>rsi</code> values in there. If you remember these two registers indicate the first two arguments passed to a function. In this case, the arguments to main function will be the <code>argc</code> and <code>argv</code>.</p><ul><li><code>argc</code> &ndash;> Count of the cli arguments passed to it.</li><li><code>argv</code> &ndash;> Pointer to the list of arguments passed.</li></ul><p>Next up is the comparision&mldr;which will check the count of args. This decides the branch the program execution takes - die or live.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-36</span><span class=p>],</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L11</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>die</span>
</span></span></code></pre></div><p>This compares <code>[rbp-36]</code> (<code>argc</code>) with hardcoded value of <code>3</code>. If the value from <code>argc</code> is greater than <code>3</code> then it&rsquo;ll make a jump to <code>.L11</code>, otherwise it&rsquo;ll call <code>die</code> function&mldr; which will print some messages and then <code>exit</code> with status <code>1</code>. We already looked at that.</p><p>So if we write a C program for what we know about <code>main</code> till now, we&rsquo;ll get something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=cm>/* Keep on going to know more */</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Next statements are something new, so you&rsquo;ll have to believe me when I say that this is equivalent to <code>argv[1]</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>.L11:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span></code></pre></div><p>Before I start explaining, take a look at this diagram.</p><div class="goat svg-container"><svg xmlns="http://www.w3.org/2000/svg" font-family="Menlo,Lucida Console,monospace" viewBox="0 0 840 489"><g transform="translate(8,16)"><text text-anchor="middle" x="24" y="180" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="32" y="180" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="40" y="180" fill="currentcolor" style="font-size:1em">x</text><text text-anchor="middle" x="48" y="196" fill="currentcolor" style="font-size:1em">┌</text><text text-anchor="middle" x="48" y="212" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="48" y="228" fill="currentcolor" style="font-size:1em">└</text><text text-anchor="middle" x="56" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="56" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="64" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="64" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="72" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="72" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="80" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="80" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="88" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="88" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="96" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="96" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="104" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="104" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="112" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="112" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="120" y="116" fill="currentcolor" style="font-size:1em">┌</text><text text-anchor="middle" x="120" y="132" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="120" y="148" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="120" y="164" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="120" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="120" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="128" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="128" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="128" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="136" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="136" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="136" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="144" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="144" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="144" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="152" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="152" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="152" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="160" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="160" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="160" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="168" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="168" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="168" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="176" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="176" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="176" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="184" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="184" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="184" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="192" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="192" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="192" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="200" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="200" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="200" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="208" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="208" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="208" y="228" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="216" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="216" y="196" fill="currentcolor" style="font-size:1em">┐</text><text text-anchor="middle" x="216" y="212" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="216" y="228" fill="currentcolor" style="font-size:1em">┘</text><text text-anchor="middle" x="224" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="232" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="240" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="248" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="256" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="264" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="272" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="280" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="288" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="296" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="304" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="312" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="320" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="328" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="336" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="344" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="352" y="116" fill="currentcolor" style="font-size:1em">►</text><text text-anchor="middle" x="384" y="116" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="392" y="116" fill="currentcolor" style="font-size:1em">b</text><text text-anchor="middle" x="400" y="116" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="408" y="116" fill="currentcolor" style="font-size:1em">-</text><text text-anchor="middle" x="416" y="116" fill="currentcolor" style="font-size:1em">4</text><text text-anchor="middle" x="424" y="116" fill="currentcolor" style="font-size:1em">8</text><text text-anchor="middle" x="448" y="36" fill="currentcolor" style="font-size:1em">┌</text><text text-anchor="middle" x="448" y="52" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="68" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="84" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="100" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="116" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="132" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="148" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="164" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="180" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="196" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="212" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="228" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="244" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="260" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="276" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="292" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="308" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="324" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="340" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="356" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="372" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="388" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="404" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="420" fill="currentcolor" style="font-size:1em">├</text><text text-anchor="middle" x="448" y="436" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="452" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="448" y="468" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="456" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="456" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="116" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="464" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="308" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="464" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="464" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="116" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="472" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="308" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="472" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="340" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="472" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="372" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="472" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="472" y="404" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="472" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="116" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="480" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="308" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="480" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="340" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="480" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="372" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="480" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="480" y="404" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="480" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="116" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="488" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="308" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="488" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="340" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="488" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="372" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="488" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="488" y="404" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="488" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="116" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="496" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="308" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="496" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="340" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="496" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="372" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="496" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="496" y="404" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="496" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="116" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="504" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="308" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="504" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="340" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="504" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="372" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="504" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="504" y="404" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="504" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="116" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="512" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="308" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="512" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="340" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="512" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="372" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="512" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="512" y="404" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="512" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="116" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="520" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="308" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="520" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="340" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="520" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="372" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="520" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="520" y="404" fill="currentcolor" style="font-size:1em">+</text><text text-anchor="middle" x="520" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="116" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="528" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="308" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="528" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="340" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="528" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="372" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="528" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="528" y="404" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="528" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="116" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="536" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="308" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="536" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="340" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="536" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="372" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="536" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="536" y="404" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="536" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="116" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="544" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="308" fill="currentcolor" style="font-size:1em">g</text><text text-anchor="middle" x="544" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="340" fill="currentcolor" style="font-size:1em">g</text><text text-anchor="middle" x="544" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="372" fill="currentcolor" style="font-size:1em">g</text><text text-anchor="middle" x="544" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="544" y="404" fill="currentcolor" style="font-size:1em">g</text><text text-anchor="middle" x="544" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="116" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="552" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="308" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="552" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="340" fill="currentcolor" style="font-size:1em">1</text><text text-anchor="middle" x="552" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="372" fill="currentcolor" style="font-size:1em">2</text><text text-anchor="middle" x="552" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="552" y="404" fill="currentcolor" style="font-size:1em">3</text><text text-anchor="middle" x="552" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="116" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="560" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="308" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="560" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="560" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="116" fill="currentcolor" style="font-size:1em">v</text><text text-anchor="middle" x="568" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="308" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="568" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="568" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="116" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="576" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="308" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="576" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="576" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="116" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="584" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="308" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="584" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="584" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="116" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="592" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="592" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="116" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="600" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="600" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="608" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="616" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="36" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="68" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="100" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="132" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="164" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="196" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="292" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="324" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="356" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="388" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="624" y="420" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="632" y="36" fill="currentcolor" style="font-size:1em">┐</text><text text-anchor="middle" x="632" y="52" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="68" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="84" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="100" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="116" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="132" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="148" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="164" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="180" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="196" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="212" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="228" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="244" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="260" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="276" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="292" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="308" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="324" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="340" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="356" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="372" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="388" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="404" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="420" fill="currentcolor" style="font-size:1em">┤</text><text text-anchor="middle" x="632" y="436" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="452" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="632" y="468" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="648" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="648" y="308" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="648" y="340" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="648" y="372" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="648" y="404" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="656" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="656" y="308" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="656" y="340" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="656" y="372" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="656" y="404" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="664" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="664" y="308" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="664" y="340" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="664" y="372" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="664" y="404" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="672" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="672" y="308" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="672" y="340" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="672" y="372" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="672" y="404" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="680" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="680" y="308" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="680" y="340" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="680" y="372" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="680" y="404" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="688" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="688" y="308" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="688" y="340" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="688" y="372" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="688" y="404" fill="currentcolor" style="font-size:1em">p</text><text text-anchor="middle" x="696" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="696" y="308" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="696" y="340" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="696" y="372" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="696" y="404" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="704" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="704" y="308" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="704" y="340" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="704" y="372" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="704" y="404" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="712" y="116" fill="currentcolor" style="font-size:1em">─</text><text text-anchor="middle" x="712" y="308" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="712" y="340" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="712" y="372" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="712" y="404" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="720" y="116" fill="currentcolor" style="font-size:1em">┐</text><text text-anchor="middle" x="720" y="132" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="148" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="164" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="180" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="196" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="212" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="228" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="244" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="260" fill="currentcolor" style="font-size:1em">│</text><text text-anchor="middle" x="720" y="276" fill="currentcolor" style="font-size:1em">▼</text><text text-anchor="middle" x="720" y="308" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="720" y="340" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="720" y="372" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="720" y="404" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="728" y="308" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="728" y="340" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="728" y="372" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="728" y="404" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="736" y="308" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="736" y="340" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="736" y="372" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="736" y="404" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="744" y="308" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="744" y="340" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="744" y="372" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="744" y="404" fill="currentcolor" style="font-size:1em">_</text><text text-anchor="middle" x="752" y="308" fill="currentcolor" style="font-size:1em">v</text><text text-anchor="middle" x="752" y="340" fill="currentcolor" style="font-size:1em">v</text><text text-anchor="middle" x="752" y="372" fill="currentcolor" style="font-size:1em">v</text><text text-anchor="middle" x="752" y="404" fill="currentcolor" style="font-size:1em">v</text><text text-anchor="middle" x="760" y="308" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="760" y="340" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="760" y="372" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="760" y="404" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="768" y="308" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="768" y="340" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="768" y="372" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="768" y="404" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="776" y="308" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="776" y="340" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="776" y="372" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="776" y="404" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="784" y="308" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="784" y="340" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="784" y="372" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="784" y="404" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="800" y="340" fill="currentcolor" style="font-size:1em">+</text><text text-anchor="middle" x="800" y="372" fill="currentcolor" style="font-size:1em">+</text><text text-anchor="middle" x="800" y="404" fill="currentcolor" style="font-size:1em">+</text><text text-anchor="middle" x="816" y="340" fill="currentcolor" style="font-size:1em">8</text><text text-anchor="middle" x="816" y="372" fill="currentcolor" style="font-size:1em">1</text><text text-anchor="middle" x="816" y="404" fill="currentcolor" style="font-size:1em">2</text><text text-anchor="middle" x="824" y="372" fill="currentcolor" style="font-size:1em">6</text><text text-anchor="middle" x="824" y="404" fill="currentcolor" style="font-size:1em">4</text></g></svg></div><p>Now with this in your mind, we can start to understand the above 3 instructions.</p><ul><li><code>mov rax, QWORD PTR [rbp-48]</code></li></ul><p>This instruction loads the <code>some_pointer_value</code> into <code>rax</code> register.</p><ul><li><code>add rax, 8</code></li></ul><p>This adds up <code>8</code> to <code>rax</code> value. That means now the resultant value is <code>some_pointer_value + 8</code>. If you don&rsquo;t know it already, <code>8</code> is the size of a pointer on most x86_64 machines. So if we want to add for 2 pointers, we&rsquo;ll need something like <code>some_pointer_value + 16</code>.</p><ul><li><code>mov rax, QWORD PTR [rax]</code></li></ul><p>Now we load the value from that location. In C language, this would be equivalent to <code>*(argv + 1)</code> or <code>argv[1]</code> or if you are feeling funny <code>1[argv]</code>. <strong><a href=https://stackoverflow.com/questions/381542/with-arrays-why-is-it-the-case-that-a5-5a>HOW??</a></strong> <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>Now, next instruction calls <code>atoi</code> function with the <code>argv[1]</code> as it&rsquo;s first argument.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rdi</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>atoi</span>
</span></span></code></pre></div><p><code>atoi</code> function changes character value to respective integer value. As an example, <code>'1'</code> (in char) will be converted to <code>1</code> (in int).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>],</span> <span class=no>eax</span>
</span></span></code></pre></div><p>And then whatever is returned by that function will be stored in a local variable pointed by <code>rbp-12</code>. Remember, <code>eax</code> register is used to store the return values from called functions (<code>atio</code>) to caller function (<code>main</code>).</p><p>Next set of instructions is quite similar to what we just saw.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>24</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rdi</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>atoi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>],</span> <span class=no>eax</span>
</span></span></code></pre></div><p>If you notice, here we are adding <code>24</code><em>(8 * 3 = 24)</em> so that means <code>arg3</code> is being used - <code>argv[3]</code>. Till this point we have successfully converted <code>argv[1]</code> and <code>argv[3]</code> to integers. These are the number1 and number2 values for our litte calculator.</p><p>Now <code>argv[2]</code>&mldr; our operator character&mldr; 1 byte value.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>add</span>     <span class=no>rax</span><span class=p>,</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>movzx</span>   <span class=no>eax</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rax</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>],</span> <span class=no>al</span>
</span></span></code></pre></div><p>This adds <code>16</code> - means <code>argv[2]</code>. So we load the value and then just pick up the lowest 1 byte value <code>al</code> from the whole thing and store it in <code>[rbp-17]</code> location.</p><p>Let&rsquo;s update our C program with the new findings.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kt>int</span> <span class=n>num1</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                <span class=kt>int</span> <span class=n>num2</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                <span class=kt>char</span> <span class=n>op</span> <span class=o>=</span> <span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=cm>/* Keep on going to know more */</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Next few lines of disassembly code looks like a conditional branch&mldr;. So many &ldquo;compare and jump&rdquo; instructions.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl>        <span class=nf>movsx</span>   <span class=no>eax</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>47</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L12</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>47</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>45</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L14</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>45</span>
</span></span><span class=line><span class=cl>        <span class=nf>jg</span>      <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>42</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L15</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>43</span>
</span></span><span class=line><span class=cl>        <span class=nf>jne</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>addFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L14:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>subFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L15:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>mulFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>jmp</span>     <span class=no>.L13</span>
</span></span><span class=line><span class=cl><span class=nl>.L12:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>],</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:</span><span class=no>divFunc</span>
</span></span><span class=line><span class=cl>        <span class=nf>nop</span>
</span></span></code></pre></div><p>The value being compared is stored in <code>[rbp-17]</code> in this case. This contains the operator character from <code>argv[2]</code>. If you convert the values this is compared to to char equivalents, you&rsquo;ll get the following:</p><ul><li>47 is <code>/</code>,</li><li>45 is <code>-</code>,</li><li>42 is <code>*</code>, and</li><li>43 is <code>+</code>.</li></ul><p>With some calculations, you can conclude where the control will jump. To sum up,</p><ul><li><p>if the operator is 47 (<code>/</code>), then it&rsquo;ll jump to <code>.L12</code>. Which will move the offset location for <code>divFunc</code> function to a local variable.</p></li><li><p>if the operator is 45 (<code>-</code>), then it&rsquo;ll move offset location for <code>subFunc</code> function to that local variable.</p></li><li><p>if the operator is 42 (<code>*</code>), then it&rsquo;ll move offset location for <code>mulFunc</code> function to that local variable.</p></li><li><p>if the operator is 42 (<code>+</code>), then it&rsquo;ll move offset location for <code>addFunc</code> function to that local variable.</p></li><li><p>In any other given input, it&rsquo;ll simply move forward to <code>.L13</code>.</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nl>.L13:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>rcx</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>edx</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>rcx</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nf>movsx</span>   <span class=no>edx</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-17</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>ecx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>r8d</span><span class=p>,</span> <span class=no>esi</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>esi</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:.</span><span class=no>LC2</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>printf</span>
</span></span><span class=line><span class=cl>        <span class=nf>nop</span>
</span></span><span class=line><span class=cl>        <span class=nf>leave</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span></code></pre></div><p>Before reaching <code>.L13</code>, we have 4 variables in our program:-</p><ul><li>number1 - stored at <code>[rbp-12]</code></li><li>number2 - stored at <code>[rbp-16]</code></li><li>operator - stored at <code>[rbp-17]</code></li><li>pointer to the function which is selected on the basis of operator. This is stored at <code>[rbp-8]</code>.</li></ul><p>Now that we&rsquo;re in <code>.L13</code>,</p><p>We assign the <code>number1</code>, <code>number2</code>, and the <code>function pointer</code> to <code>eax</code>, <code>edx</code>, and <code>rcx</code>, respectively. The <code>function</code> is then called with the arguments <code>number1</code> and <code>number2</code>. Finally, the outcome is saved.</p><p>The remainder of the <code>.L13</code> consists entirely of calling a <code>printf</code> function with a format string and other local variables. The final result will look like this: <code>&lt;number1> &lt;operator> &lt;number2> = &lt;result_from_function></code>. I&rsquo;ll leave it to you to dissect and solve the final puzzle piece. After printing, the function then exits gracefully.</p><p>Now we can put everything together, and the complete code should look something like this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// Function to perform addition
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=nf>addFunc</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Function to perform subtraction
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=nf>subFunc</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span> <span class=o>-</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Function to perform multiplication
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=nf>mulFunc</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span> <span class=o>*</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Function to perform division
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=nf>divFunc</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span> <span class=o>/</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Function to print usage message and exit
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>die</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Not enough arguments passed</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Usage: ./calc &lt;num1&gt; &lt;operator&gt; &lt;num2&gt;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// main function
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>argc</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=nf>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>option</span> <span class=o>=</span> <span class=o>*</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=n>fp</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>switch</span><span class=p>(</span><span class=n>option</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;+&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=n>fp</span> <span class=o>=</span> <span class=n>addFunc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;-&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=n>fp</span> <span class=o>=</span> <span class=n>subFunc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;*&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=n>fp</span> <span class=o>=</span> <span class=n>mulFunc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;/&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=n>fp</span> <span class=o>=</span> <span class=n>divFunc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d %c %d = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>option</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=nf>fp</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This may not be what the original developer wrote, but it will certainly behave the same. That is the entire point of reverse engineering. Dissecting something with your tools to understand how it behaves and then creating something that mimics the behavior.</p><p>I&rsquo;ll encourage you to go and try to reverse engineer some more binaries. You can build your own if you want or just download some from online platforms like <a href=https://crackmes.one/>crackme.one</a>. Have fun!!</p><p><img loading=lazy src=https://media.giphy.com/media/OB4Sjggq8aMJnq4sLQ/giphy.gif#center alt></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://stackoverflow.com/questions/381542/with-arrays-why-is-it-the-case-that-a5-5a>https://stackoverflow.com/questions/381542/with-arrays-why-is-it-the-case-that-a5-5a</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ayedaemon.github.io/tags/re/>RE</a></li><li><a href=https://ayedaemon.github.io/tags/linux/>Linux</a></li><li><a href=https://ayedaemon.github.io/tags/c-programming/>C programming</a></li></ul><nav class=paginav><a class=prev href=https://ayedaemon.github.io/post/2023/05/eudyptula-task-7/><span class=title>« Next</span><br><span>Eudyptula Task 7</span>
</a><a class=next href=https://ayedaemon.github.io/post/2023/04/intro-to-re-part-3/><span class=title>Prev »</span><br><span>Intro to Re: C : part-3</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://ayedaemon.github.io/>Connected</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>