<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>docker on Connected</title>
    <link>https://ayedaemon.github.io/tags/docker/</link>
    <description>Recent content in docker on Connected</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 02 Apr 2024 17:19:43 +0530</lastBuildDate>
    <atom:link href="https://ayedaemon.github.io/tags/docker/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Hands-on Intro to SBOM</title>
      <link>https://ayedaemon.github.io/post/2022/05/hands-on-intro-to-sbom/</link>
      <pubDate>Fri, 27 May 2022 22:56:22 +0530</pubDate>
      <guid>https://ayedaemon.github.io/post/2022/05/hands-on-intro-to-sbom/</guid>
      <description>The concept of a Bill Of Materials (BOM) is well-established in traditional manufacturing as part of supply chain management. A manufacturer uses a BOM to track the parts it uses to create a product. If defects are later found in a specific part, the BOM makes it easy to locate affected products. In software industry, this concept is fairly new and is used to keep track of all the ingredients of the software.</description>
      <content:encoded><![CDATA[<p>The concept of a Bill Of Materials (BOM) is well-established in traditional manufacturing as part of supply chain management. A manufacturer uses a BOM to track the parts it uses to create a product. If defects are later found in a specific part, the BOM makes it easy to locate affected products. In software industry, this concept is fairly new and is used to keep track of all the ingredients of the software.</p>
<h3 id="what-is-sbom-">What is SBOM ??</h3>
<p>A software bill of materials (SBOM) is a formal record of the components used to develop software and its software supply chain relationships, according to the National Telecommunications and Information Administration (NTIA). An SBOM covers both open source (OSS) and proprietary software, creating transparency into potential vulnerabilities and elements within the software. SBOMs can be used for vulnerability management and product integrity.</p>
<p>An SBOM is useful both to the builder (manufacturer) and the buyer (customer) of a software product. Builders often leverage available open source and third-party software components to create a product; an SBOM allows the builder to make sure those components are up to date and to respond quickly to new vulnerabilities. Buyers can use an SBOM to perform vulnerability or license analysis, both of which can be used to evaluate risk in a product.</p>
<h3 id="why-sbom-">Why SBOM ??</h3>
<p>There could be multiple usages of SBOM, like</p>
<ul>
<li>easy End-Of-Life management for dependencies and product itself.</li>
<li>License obligations and policy compliance.</li>
<li>For developers, it can help to unbloat the software by identifying the BOM and clean up unused things or can use it for quality assurance.</li>
<li>Identify and eliminate vulnerabilities from early stages (more shift left)</li>
</ul>
<p>There are many artifacts that can provide SBOM information and this information can be correlated and used together to provide better security insights. These artifacts could be the source code, executables,  published softwares, or in devops world, <strong>containers</strong>!!</p>
<p>Containers are easy way to package and deliver software; Container is like an encapsulated artifact. Here we can get SBOM for <strong>Application dependencies, Secret code, OS packages, Licenses, File data, Configuration files, Container meta-data, etc</strong>. When it comes to security, it’s important to know every part of the system. SBOM gives you a clear list of components that help in monitoring every part for vulnerabilities.</p>
<h3 id="existing-sbom-formats">Existing SBOM formats</h3>
<p>A new SBOM can be created and published in various formats including HTML, CSV, PDF, Markdown, and plain text. SBOM formats are still in development and new formats might arise in future that can address specific problems in a better way. Currently used formats are -  Software Package Data Exchange (SPDX), Software Identification (SWID) Tags, and Cyclone DX.</p>
<ol>
<li><a href="https://spdx.dev/"><strong>SPDX</strong></a></li>
</ol>
<p>Also known as ISO/IEC 5962:2021, SPDX is spearheaded by The Linux Foundation. It is an open standard for describing SBOM information related to provenance, licensing, and security.</p>
<ol start="2">
<li><a href="https://csrc.nist.gov/projects/Software-Identification-SWID"><strong>SWID Tags</strong></a></li>
</ol>
<p>This format identifies and reports software components under four categories across the development lifecycle:</p>
<ul>
<li>Corpus Tags: Identifies and describes components in a pre-installation stage.</li>
<li>Primary Tags: Identifies and describes components in a post-installation stage.</li>
<li>Patch Tags: Identifies and describes the patch.</li>
<li>Supplement Tags: Allows only the tag creator to modify corpus, primary, and patch tags.</li>
</ul>
<ol start="3">
<li><a href="https://cyclonedx.org/"><strong>Cyclone DX</strong></a></li>
</ol>
<p>Managed by Cyclone DX’s core working group, it is designed for application security contexts. Cyclone DX is considered a lightweight standard with features of both SPDX and SWID. It includes four data fields:</p>
<ul>
<li><strong>BOM Metadata</strong>: Description of the supplier, manufacturer, component, and compilation tools.</li>
<li><strong>Components</strong>: Complete information of a proprietary and open-source components along with licensing requirements.</li>
<li><strong>Services</strong>: A list of external APIs that the software may invoke.</li>
<li><strong>Dependencies</strong>: All forms of relationship within the supply chain.</li>
</ul>
<h3 id="dont-talk-show">Don&rsquo;t talk, show!!</h3>
<p>For the demo, I&rsquo;ve created a basic flask application that says hello and have containerized it into 3 different base images - ubuntu, alpine and distroless.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS          PORTS     NAMES
</span></span><span class="line"><span class="cl">783618b1c6df   sbom_distroless   <span class="s2">&#34;/usr/bin/python3.9 …&#34;</span>   <span class="m">9</span> seconds ago    Up <span class="m">7</span> seconds              sbom_distroless_demo
</span></span><span class="line"><span class="cl">3ed64aef4767   sbom_alpine       <span class="s2">&#34;python app.py&#34;</span>          <span class="m">16</span> seconds ago   Up <span class="m">14</span> seconds             sbom_alpine_demo
</span></span><span class="line"><span class="cl">fe18c421777a   sbom_ubuntu       <span class="s2">&#34;python3 app.py&#34;</span>         <span class="m">19</span> seconds ago   Up <span class="m">17</span> seconds             sbom_ubuntu_demo
</span></span></code></pre></div><p>We can check the size of the container image using 	<code>docker images</code> command.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">sbom_distroless             latest       6ef7ccd61f84   38 minutes ago      166MB
</span></span><span class="line"><span class="cl">sbom_alpine                 latest       e7e71b412cf5   About an hour ago   161MB
</span></span><span class="line"><span class="cl">sbom_ubuntu                 latest       9e2166292230   About an hour ago   573MB
</span></span></code></pre></div><p>If you want to get more details about the size of each layer then you can use <code>docker history &lt;image&gt;</code> command. More information about the running container (process) can be obtained using <code>docker inspect &lt;container&gt;</code>.</p>
<p>All these commands are good, but they do not provide any information about the application and its dependencies. Docker has recently announced its experimental feature - <code>docker sbom</code>, that allows us to generate the SBOM of a container image. Today, it does this by scanning the layers of the image using the <a href="https://github.com/anchore/syft"><strong>Syft</strong></a> project but in future it may read the SBOM from the image itself or elsewhere.</p>
<p>Let&rsquo;s generate a SBOM for our containers by directly using the syft project.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">syft sbom_distroless
</span></span><span class="line"><span class="cl"> ✔ Loaded image
</span></span><span class="line"><span class="cl"> ✔ Parsed image
</span></span><span class="line"><span class="cl"> ✔ Cataloged packages      [69 packages]
</span></span><span class="line"><span class="cl">NAME                  VERSION                       TYPE
</span></span><span class="line"><span class="cl">Flask                 2.1.2                         python
</span></span><span class="line"><span class="cl">Jinja2                3.1.2                         python
</span></span><span class="line"><span class="cl">MarkupSafe            2.1.1                         python
</span></span><span class="line"><span class="cl">Werkzeug              2.1.2                         python
</span></span><span class="line"><span class="cl">base-files            11.1+deb11u3                  deb
</span></span><span class="line"><span class="cl">boto3                 1.23.9                        python
</span></span><span class="line"><span class="cl">botocore              1.26.9                        python
</span></span><span class="line"><span class="cl">certifi               2022.5.18.1                   python
</span></span><span class="line"><span class="cl">charset-normalizer    2.0.12                        python
</span></span><span class="line"><span class="cl">click                 8.1.3                         python
</span></span><span class="line"><span class="cl">dash                  0.5.11+git20200708+dd9ef66-5  deb
</span></span><span class="line"><span class="cl">idna                  3.3                           python
</span></span><span class="line"><span class="cl">importlib-metadata    4.11.4                        python
</span></span><span class="line"><span class="cl">itsdangerous          2.1.2                         python
</span></span><span class="line"><span class="cl">jmespath              1.0.0                         python
</span></span><span class="line"><span class="cl">libbz2-1.0            1.0.8-4                       deb
</span></span><span class="line"><span class="cl">libc-bin              2.31-13+deb11u3               deb
</span></span><span class="line"><span class="cl">libc6                 2.31-13+deb11u3               deb
</span></span><span class="line"><span class="cl">libcom-err2           1.46.2-2                      deb
</span></span><span class="line"><span class="cl">libcrypt1             1:4.4.18-4                    deb
</span></span><span class="line"><span class="cl">libdb5.3              5.3.28+dfsg1-0.8              deb
</span></span><span class="line"><span class="cl">libexpat1             2.2.10-2+deb11u3              deb
</span></span><span class="line"><span class="cl">libffi7               3.3-6                         deb
</span></span><span class="line"><span class="cl">libgcc-s1             10.2.1-6                      deb
</span></span><span class="line"><span class="cl">libgomp1              10.2.1-6                      deb
</span></span><span class="line"><span class="cl">libgssapi-krb5-2      1.18.3-6+deb11u1              deb
</span></span><span class="line"><span class="cl">libk5crypto3          1.18.3-6+deb11u1              deb
</span></span><span class="line"><span class="cl">libkeyutils1          1.6.1-2                       deb
</span></span><span class="line"><span class="cl">libkrb5-3             1.18.3-6+deb11u1              deb
</span></span><span class="line"><span class="cl">libkrb5support0       1.18.3-6+deb11u1              deb
</span></span><span class="line"><span class="cl">liblzma5              5.2.5-2.1~deb11u1             deb
</span></span><span class="line"><span class="cl">libmpdec3             2.5.1-1                       deb
</span></span><span class="line"><span class="cl">libncursesw6          6.2+20201114-2                deb
</span></span><span class="line"><span class="cl">libnsl2               1.3.0-2                       deb
</span></span><span class="line"><span class="cl">libpython3.9-minimal  3.9.2-1                       deb
</span></span><span class="line"><span class="cl">libreadline8          8.1-1                         deb
</span></span><span class="line"><span class="cl">libsqlite3-0          3.34.1-3                      deb
</span></span><span class="line"><span class="cl">libssl1.1             1.1.1n-0+deb11u2              deb
</span></span><span class="line"><span class="cl">libstdc++6            10.2.1-6                      deb
</span></span><span class="line"><span class="cl">libtinfo6             6.2+20201114-2                deb
</span></span><span class="line"><span class="cl">libtirpc3             1.3.1-1                       deb
</span></span><span class="line"><span class="cl">libuuid1              2.36.1-8+deb11u1              deb
</span></span><span class="line"><span class="cl">netbase               6.3                           deb
</span></span><span class="line"><span class="cl">openssl               1.1.1n-0+deb11u2              deb
</span></span><span class="line"><span class="cl">pip                   22.0.4                        python
</span></span><span class="line"><span class="cl">pip                   22.1.1                        python
</span></span><span class="line"><span class="cl">python-dateutil       2.8.2                         python
</span></span><span class="line"><span class="cl">python3-distutils     3.9.2-1                       deb
</span></span><span class="line"><span class="cl">requests              2.27.1                        python
</span></span><span class="line"><span class="cl">s3transfer            0.5.2                         python
</span></span><span class="line"><span class="cl">setuptools            58.1.0                        python
</span></span><span class="line"><span class="cl">six                   1.16.0                        python
</span></span><span class="line"><span class="cl">tzdata                2021a-1+deb11u3               deb
</span></span><span class="line"><span class="cl">urllib3               1.26.9                        python
</span></span><span class="line"><span class="cl">wheel                 0.37.1                        python
</span></span><span class="line"><span class="cl">zipp                  3.8.0                         python
</span></span><span class="line"><span class="cl">zlib1g                1:1.2.11.dfsg-2+deb11u1       deb
</span></span></code></pre></div><p>By default, syft parses and analyses the final layer of the container and displays the tabular result on the standard output (stdout). This is good if we just want to see the SBOM ourselves and not want to share it with other tools or people. To save the output to a file you can use <code>--file</code> option and you can also specify another formats that are widely used by community with <code>-o</code> or <code>--output</code> flag. Below bash script will create <code>cyclonedx-json</code> , <code>github-json</code>,  <code>spdx-json</code>and <code>syft-json</code>  format SBOMs and also store them in their respective files.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p generated_sboms<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in sbom_<span class="o">{</span>ubuntu,distroless,alpine<span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl">mkdir -p generated_sboms/<span class="nv">$i</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">syft <span class="nv">$i</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-o syft-json<span class="o">=</span>generated_sboms/<span class="nv">$i</span>/syft.json <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-o spdx-json<span class="o">=</span>generated_sboms/<span class="nv">$i</span>/spdx.json <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-o github-json<span class="o">=</span>generated_sboms/<span class="nv">$i</span>/github.json <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-o cyclonedx-json<span class="o">=</span>generated_sboms/<span class="nv">$i</span>/cyclonedx.json
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div><p>Output of the above script provides us with package count for each image and it is clear that the ubuntu has most of them as it is a full fledged distro with a lot of system files, manpages, etc&hellip; and distroless images have the least one. The idea of distroless is somewhat over-hyped in the world of containers and sometimes it can be related with
security ideas of minimum attack surface. <a href="https://www.redhat.com/en/blog/why-distroless-containers-arent-security-solution-you-think-they-are">Here is a RedHat article</a> that try to give a clear understanding of the benefits of distroless containers and myths around it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">sbom_ubuntu
</span></span><span class="line"><span class="cl"> ✔ Loaded image
</span></span><span class="line"><span class="cl"> ✔ Parsed image
</span></span><span class="line"><span class="cl"> ✔ Cataloged packages      [265 packages]
</span></span><span class="line"><span class="cl">sbom_distroless
</span></span><span class="line"><span class="cl"> ✔ Loaded image
</span></span><span class="line"><span class="cl"> ✔ Parsed image
</span></span><span class="line"><span class="cl"> ✔ Cataloged packages      [69 packages]
</span></span><span class="line"><span class="cl">sbom_alpine
</span></span><span class="line"><span class="cl"> ✔ Loaded image
</span></span><span class="line"><span class="cl"> ✔ Parsed image
</span></span><span class="line"><span class="cl"> ✔ Cataloged packages      [71 packages]
</span></span></code></pre></div><p>And it&rsquo;ll create a directory with organised json files</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl"># tree generated_sboms/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">generated_sboms/
</span></span><span class="line"><span class="cl">├── sbom_alpine
</span></span><span class="line"><span class="cl">│   ├── cyclonedx.json
</span></span><span class="line"><span class="cl">│   ├── github.json
</span></span><span class="line"><span class="cl">│   ├── spdx.json
</span></span><span class="line"><span class="cl">│   └── syft.json
</span></span><span class="line"><span class="cl">├── sbom_distroless
</span></span><span class="line"><span class="cl">│   ├── cyclonedx.json
</span></span><span class="line"><span class="cl">│   ├── github.json
</span></span><span class="line"><span class="cl">│   ├── spdx.json
</span></span><span class="line"><span class="cl">│   └── syft.json
</span></span><span class="line"><span class="cl">└── sbom_ubuntu
</span></span><span class="line"><span class="cl">    ├── cyclonedx.json
</span></span><span class="line"><span class="cl">    ├── github.json
</span></span><span class="line"><span class="cl">    ├── spdx.json
</span></span><span class="line"><span class="cl">    └── syft.json
</span></span></code></pre></div><p>Now we have our sbom files and we can share these files to other people who need it. It can be our customers, external auditors, Incident response team, etc etc&hellip; Also we can use these files with another tool that can check these images for vulnerabilities. One such tool is <a href="https://github.com/anchore/grype"><strong>grype</strong></a> - A vulnerability scanner for container images and filesystems that works exceptionally with Syft. Below script will generate grype results for all the 3 images using their respective <code>spdx.json</code> files.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p grype_results<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in sbom_<span class="o">{</span>ubuntu,distroless,alpine<span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">mkdir -p grype_results/<span class="nv">$i</span>
</span></span><span class="line"><span class="cl">grype sbom:./generated_sboms/sbom_ubuntu/spdx.json <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-o json <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--file grype_results/<span class="nv">$i</span>/all.json
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div><p>Like all static analysers, this tool might generate tons of false positives. Apart from this, grype tool provides tons of configuration features that can come in handy for automations and several other usecases. A lot of other commercial and open-source tools are arising that can leverage SBOMs and can help to solve problems around licencing and policy compliene, security audits, quality assurance, etc.</p>
<h3 id="sbom-misconception">SBOM misconception</h3>
<p>There are few misconeptions or myths about SBOMs like it can :-</p>
<ol>
<li>be a roadmap to the attacker ?</li>
<li>require source code disclosure ?</li>
<li>expose my intellectual properties ? .. etc</li>
</ol>
<p><a href="https://www.ntia.gov/files/ntia/publications/sbom_myths_vs_facts_nov2021.pdf">Here is a NTIA publication</a> that covers explaination of some such myths V/S facts.</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
