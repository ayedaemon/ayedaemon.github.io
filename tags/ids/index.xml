<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>IDS on Connected</title>
    <link>https://ayedaemon.github.io/tags/ids/</link>
    <description>Recent content in IDS on Connected</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 19 Dec 2020 14:25:28 +0530</lastBuildDate><atom:link href="https://ayedaemon.github.io/tags/ids/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Advanced Intrusion Detection Environment</title>
      <link>https://ayedaemon.github.io/post/2020/12/advanced-intrusion-detection-environment/</link>
      <pubDate>Sat, 19 Dec 2020 14:25:28 +0530</pubDate>
      
      <guid>https://ayedaemon.github.io/post/2020/12/advanced-intrusion-detection-environment/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;Host-based intrusion detection system (HIDS) for checking the integrity of files.&lt;/p&gt;
&lt;/blockquote&gt;</description>
      <content:encoded><![CDATA[<blockquote>
<p>Host-based intrusion detection system (HIDS) for checking the integrity of files.</p>
</blockquote>
<p>Advanced Intrusion Detection Environment (AIDE) is a <strong>host-based intrusion detection system (HIDS)</strong> for checking the integrity of files. It does this by creating a <strong>baseline database</strong> of files on an initial run, and then checks this database against the system on subsequent runs. File properties that can be checked against include inode, permissions, modification time, file contents, etc‚Ä¶‚Ä¶‚Ä¶.. <a href="https://wiki.archlinux.org/index.php/AIDE"><em>more at archwiki</em>üìö</a></p>
<p>According to the definition, AIDE only checks for the <strong>integrity of file</strong> but <strong>not for rootkits</strong> and logs for other suspicious activities.</p>
<p><em>But there are other HIDS tools that can do this for you. Like,</em> <a href="https://www.splunk.com/"><em>Splunk</em></a> <em>and</em> <a href="https://www.ossec.net/"><em>OSSEC</em></a><em>.</em></p>
<p>AIDE have provided a <a href="https://aide.github.io/doc/">pretty simple documentation</a> to undertand and get familiar with it.</p>
<h3 id="how-to-install-it">How to install it?</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1"># Check what repo will provide you aide tool.  </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">yum</span> <span class="n">whatprovides</span> <span class="n">aide</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># And then install it, if available.  </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">yum</span> <span class="n">install</span> <span class="n">aide</span> <span class="o">-</span><span class="n">y</span>
</span></span></code></pre></div><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*GH5ZoirRAKBXJOdkSk4K2A.png" alt="aide-whatprovides-install"  />
</p>
<h3 id="next-step-">Next step ..??</h3>
<p>Let‚Äôs check the files unpacked from the <strong>aide package</strong> we just installed.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*WBBWo0dITSPIgjfNqPTrZA.png" alt="aide-rpm-ql"  />
</p>
<p>We found a configuration file ‚Äî <code>/etc/aide.conf</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># open the file with vim or your favourite text editor  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vim /etc/aide.conf  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># The file looked very huge so I checked its length.  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wc /etc/aide.conf  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># OUTPUT:  
</span></span><span class="line"><span class="cl"># 312 765 7333 /etc/aide.conf
</span></span></code></pre></div><p>Fortunately they have given a man page for the configurations settings.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">man 5 aide.conf
</span></span></code></pre></div><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*0HZv3rMcdAFMTbYiyPn_Xw.png" alt="aide.conf"  />
</p>
<p>This gives me a good news. There are only 3 types of line in the configuration file.</p>
<ul>
<li>There are the 1Ô∏è‚É£<em>configuration lines</em> which are used to <strong>set configuration parameters</strong> and <strong>define/undefine variables</strong>.</li>
<li>There are 2Ô∏è‚É£<em>selection lines</em> that are used to indicate <strong>which files are added</strong> to the database.</li>
<li>3Ô∏è‚É£ <em>macro lines</em> <strong>define or undefine variables</strong> within the config file.</li>
<li>Lines beginning with # are ignored as <strong>comments</strong>.#Ô∏è‚É£</li>
</ul>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*LRp9V0giXu-oxaae.gif" alt="Really"  />
</p>
<p>You can now check the config file and things will make more sense to you. Also you can check the key-value pairs from <a href="https://linux.die.net/man/5/aide.conf">man page</a>.</p>
<h3 id="enough-for-configuration-how-to-use-it">Enough for configuration‚Ä¶ How to use it?</h3>
<p>Go to the <a href="https://linux.die.net/man/1/aide">man page</a> of aide.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># from terminal  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">man aide
</span></span></code></pre></div><p>Again a reminder, and I quote.</p>
<blockquote>
<p>AIDE is an <strong>intrusion detection system</strong> for checking the <strong>integrity of files</strong>.</p>
</blockquote>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*gNw75QXgQiRPoxgopKvZSQ.png" alt="man-aide"  />
</p>
<p>One thing to notice here is <em><strong>DIAGNOSTICS</strong></em> (<em>Scroll down to bottom on the man page</em>).</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*m3ygM3U9O_-eooMR-3NJcA.png" alt="diagnostics"  />
</p>
<p>Another is, that AIDE can be controlled using few basic commands.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*nYCpUl-Pv4oHGnjbTsYXew.png" alt="commands"  />
</p>
<h3 id="time-for-some-fun-now">Time for some fun now!!</h3>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*eV9LiAtIIoAbbflD.gif" alt="lets-play"  />
</p>
<p><strong>Game-play</strong></p>
<ul>
<li>Create a folder and some files in it.</li>
<li>Configure AIDE to add that folder in database.</li>
<li>Have fun with the folder and files and check the AIDE logs for reports.</li>
</ul>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*4RBSuCrL2W9C1Y9MspWl2w.png" alt="create-folder"  />
</p>
<p>Adding my new folder and files to aide.conf</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#-------------- My-Settings ---------------  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">myfilter = sha256  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/fun-with-aide myfilter
</span></span></code></pre></div><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*aC940c2LfvDHrQu_D4nKoA.png" alt="add-to-conf"  />
</p>
<p>This rule is a regular expression rule and will match the complete path of any file starting from /fun-with-aide, so this will include the files inside this folder.</p>
<p>Now some simple steps to follow:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">*</span> <span class="n">aide</span> <span class="o">--</span><span class="n">init</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span> <span class="n">cp</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">aide</span><span class="o">/</span><span class="n">aide</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">gz</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">aide</span><span class="o">/</span><span class="n">aide</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">gz</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span> <span class="n">aide</span> <span class="o">--</span><span class="n">check</span>
</span></span></code></pre></div><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*G7iCTRi0C6ttmWQe3-oxyA.png" alt="aide-check"  />
</p>
<p>What if we tinker with the file /fun-with-aide/file1?</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*wDbGmR7vps5vsqs3i8_Icg.png" alt="tinker-file1"  />
</p>
<p>I have changed the content of the file1, due to which the sha256sum has also changed. This should be reported by <strong>aide</strong> in reports.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*z0Zq2wGpayGYo079V8bgUw.png" alt="aide-check"  />
</p>
<p>This generates a report that tells about the changes. I‚Äôll get a count of <em>added files</em>, <em>removed files</em> and <em>changed files</em>, along with the name of those files and some detailed information.</p>
<hr>
<p>AIDE can be run manually if desired, but automation is the way nowadays.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*ip12LNV58018AQ8G.gif" alt="yeah-automation"  />
</p>
<p>Check the below provided simple cron job script to automatically check for the changes. For more complex examples check <a href="https://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/app-forensics/aide/files/aide.cron">this</a> and <a href="https://rfxn.com/downloads/cron.aide">this</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># SOURCE: https://wiki.archlinux.org/index.php/AIDE  </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash -e  </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># these should be the same as what&#39;s defined in /etc/aide.conf  </span>
</span></span><span class="line"><span class="cl"><span class="nv">database</span><span class="o">=</span>/var/lib/aide/aide.db.gz  
</span></span><span class="line"><span class="cl">database<span class="se">\_</span>out<span class="o">=</span>/var/lib/aide/aide.db.new.gz  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="nv">$database</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>  
</span></span><span class="line"><span class="cl"> <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$database</span><span class="s2"> not found&#34;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>  
</span></span><span class="line"><span class="cl"> <span class="nb">exit</span> <span class="m">1</span>  
</span></span><span class="line"><span class="cl"><span class="k">fi</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">aide -u <span class="o">||</span> <span class="nb">true</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mv <span class="nv">$database</span> <span class="nv">$database</span>.back  
</span></span><span class="line"><span class="cl">mv <span class="nv">$database</span><span class="se">\_</span>out <span class="nv">$database</span>
</span></span></code></pre></div><hr>
<p><strong>What about if attacker changed the database??</strong></p>
<p>When I checked the file type of the <em>aide.db.gz</em>&hellip; It came out to be a gzip compressed data, from Unix, max compression file.</p>
<p>This makes it very obvious to unzip this compressed file. I prefer using gunzip tool.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*rP1BY4TIP5OLCxQj4_GrGw.png" alt="operation-theatre"  />
</p>
<p>Specification of the db is also mentioned in the file.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*FB264rJGlMj1Tr-4tPSWHg.png" alt="db_spec"  />
</p>
<p>Visualizing the above in a tabular manner.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*3MXSU4ub4fgXolHfPB34Qw.png" alt=""  />
</p>
<p><strong>You can add more filters and integrity checks to test other things as well.</strong></p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*v87DoqZLe0Cq2K-f.gif" alt="being-tonystark"  />
</p>
<p>This whole db thing gives rise to a question. <strong>What if the attacker modifies the db??</strong></p>
<p>Hmmm.. then he winsü§∑‚Äç‚ôÇÔ∏è. You have to keep your db secure from attackers. For this, you should keep your database in <strong>read-only mode</strong>. So that it can be only read and no modifications can be done to this. Also you can keep the DB in a different location like in a <strong>centralized server</strong> or in a <strong>removable media like pendrive</strong>. Or you can have it your way.</p>
<p>You can read more about <a href="https://wiki.gentoo.org/wiki/Integrity/Concepts">Integrity Concepts</a> here for better security guidelines.</p>
<h3 id="conclusion">Conclusion</h3>
<p>In the end, let‚Äôs understand how AIDE does what it does.</p>
<p>AIDE takes a ‚Äúsnapshot‚Äù of the state of the system, register hashes, modification times, and other data regarding the files defined by the administrator. This ‚Äúsnapshot‚Äù is used to build a database that is saved and may be stored on an external device for safekeeping.</p>
<p>When the administrator wants to run an integrity test, the administrator places the previously built database in an accessible place and commands AIDE to compare the database against the real status of the system. Should a change have happened to the computer between the snapshot creation and the test, AIDE will detect it and report it to the administrator. Alternatively, AIDE can be configured to run on a schedule and report changes daily using scheduling technologies such as cron.üîö</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*S_aFpI3KDiWfts2v.gif" alt="end"  />
</p>]]></content:encoded>
    </item>
    
  </channel>
</rss>
